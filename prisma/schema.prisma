generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  lastPackOpen DateTime?
  
  cards     UserCard[]
  
  sentFriendRequests     Friendship[] @relation("sender")
  receivedFriendRequests Friendship[] @relation("receiver")
  
  sentTrades     Trade[] @relation("TradeSender")
  receivedTrades Trade[] @relation("TradeReceiver")
}

model Card {
  id        String   @id
  name      String
  imageUrl  String
  rarity    String
  setName   String
  
  users     UserCard[]
  
  offeredInTrades Trade[] @relation("OfferedCard")
  respondedInTrades Trade[] @relation("RespondedCard")
}

model UserCard {
  id        Int    @id @default(autoincrement())
  userId    Int
  cardId    String
  count     Int    @default(0)
  
  user      User   @relation(fields: [userId], references: [id])
  card      Card   @relation(fields: [cardId], references: [id])

  @@unique([userId, cardId])
}

model Friendship {
  id        Int      @id @default(autoincrement())
  senderId  Int
  receiverId Int
  status    String   @default("PENDING") // PENDING, ACCEPTED
  
  sender    User     @relation("sender", fields: [senderId], references: [id])
  receiver  User     @relation("receiver", fields: [receiverId], references: [id])

  @@unique([senderId, receiverId])
}

model Trade {
  id        Int      @id @default(autoincrement())
  senderId  Int
  receiverId Int
  
  offeredCardId String
  respondedCardId String?
  
  status    String   @default("PENDING") // PENDING, RESPONDED, ACCEPTED, REJECTED, CANCELLED
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  sender    User   @relation("TradeSender", fields: [senderId], references: [id])
  receiver  User   @relation("TradeReceiver", fields: [receiverId], references: [id])
  
  offeredCard   Card @relation("OfferedCard", fields: [offeredCardId], references: [id])
  respondedCard Card? @relation("RespondedCard", fields: [respondedCardId], references: [id])
}
